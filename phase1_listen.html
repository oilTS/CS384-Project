<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>ฟังเสียง — Phase 1</title>
<link rel="stylesheet" href="style.css">
<script src="main.js"></script>
</head>

<body>

<h2>ฟังบทความเสียง — Phase 1</h2>

<p class="notice">เสียงจะเล่นได้เพียงครั้งเดียว ไม่มีหยุด ไม่มีกรอ</p>

<audio id="audioPlayer" preload="auto">
    <source id="audioSrc" src="">
</audio>

<button id="playBtn">▶ เริ่มฟัง</button>

<p id="msg" class="error"></p>

<script>
(function(){

    const set = window.Experiment.getParam("set");
    const letter = window.Experiment.getParam("audio");
    const audio = document.getElementById("audioPlayer");
    const src = document.getElementById("audioSrc");
    const playBtn = document.getElementById("playBtn");
    
    let startTime; 

    if (!letter) {
        document.getElementById("msg").textContent = "ไม่พบพารามิเตอร์ audio=A หรือ B";
        return;
    }

    const filePath = `audio/${letter}.mp3`;
    src.src = filePath;
    audio.load();

    playBtn.onclick = () => {
        playBtn.disabled = true;
        startTime = new Date(); 
        
        audio.play()
        .then(() => {
            document.getElementById("msg").textContent = "กำลังเล่นเสียง...";
        })
        .catch(err => {
            document.getElementById("msg").textContent =
                "ไม่สามารถเล่นเสียงได้ กรุณาตรวจสอบไฟล์: " + filePath;
        });
    };

    audio.onended = () => {
        const endTime = new Date();
        const timeSpent = Math.round((endTime - startTime) / 1000); 

        const data = window.Experiment.loadExperimentData();
        data.listen_time = timeSpent;
        window.Experiment.saveExperimentData(data);

        window.location.href = `phase1_quiz.html?set=${set}&article=${letter}`;
    };
})();
</script>

</body>
</html>