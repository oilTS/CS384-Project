<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á (‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà 1)</title>
<link rel="stylesheet" href="style.css">
<script src="main.js"></script>
<style>
    /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ */
    body { text-align: center; padding: 40px 20px; line-height: 1.6; }
    h2 { margin-bottom: 20px; color: #333; }
    
    .warning-box {
        background-color: #fff3cd;
        border: 1px solid #ffeeba;
        color: #856404;
        padding: 15px;
        margin: 20px auto;
        border-radius: 5px;
        max-width: 600px;
        font-weight: bold;
    }

    /* Container ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á */
    .player-container {
        margin: 30px auto;
        max-width: 500px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 10px;
        background-color: #f9f9f9;
    }

    /* ‡∏õ‡∏∏‡πà‡∏° Play */
    #playBtn {
        padding: 15px 40px;
        font-size: 18px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    #playBtn:disabled {
        background-color: #ccc;
        cursor: not-allowed;
    }

    /* Progress Bar (Read-only) */
    .progress-wrapper {
        margin-top: 20px;
        display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î‡πÄ‡∏•‡πà‡∏ô */
    }
    
    .progress-bg {
        width: 100%;
        height: 10px;
        background-color: #e0e0e0;
        border-radius: 5px;
        overflow: hidden;
        margin-bottom: 10px;
    }
    
    .progress-fill {
        width: 0%;
        height: 100%;
        background-color: #2196F3;
        transition: width 0.25s linear;
    }

    .time-display {
        font-size: 14px;
        color: #555;
        display: flex;
        justify-content: space-between;
    }

    /* [‡πÄ‡∏û‡∏¥‡πà‡∏°] ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á */
    .story-credit {
        margin-top: 15px;
        font-size: 0.9rem;
        color: #777;
        font-style: italic;
        display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î‡πÄ‡∏•‡πà‡∏ô */
    }
</style>
</head>

<body>

    <h2>‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á - ‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà 1 (Phase 1)</h2>

    <div class="warning-box">
        ‚ö†Ô∏è ‡∏Ñ‡∏≥‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:<br>
        ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡πÄ‡∏û‡∏µ‡∏¢‡∏á 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô<br>
        ‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏±‡∏Å (Pause) ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö (Rewind) ‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á
    </div>

    <div class="player-container">
        <button id="playBtn">‚ñ∂ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢</button>

        <div id="storyCredit" class="story-credit"></div>

        <div class="progress-wrapper" id="progressArea">
            <div class="progress-bg">
                <div id="progressBar" class="progress-fill"></div>
            </div>
            <div class="time-display">
                <span id="statusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô...</span>
                <span id="timeRemaining">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤: --:--</span>
            </div>
        </div>
    </div>

    <p id="msg" class="error"></p>

    <audio id="audioPlayer" preload="auto">
        <source id="audioSrc" src="">
    </audio>

<script>
(function(){

    const set = window.Experiment.getParam("set");
    const letter = window.Experiment.getParam("audio");
    const audio = document.getElementById("audioPlayer");
    const src = document.getElementById("audioSrc");
    const playBtn = document.getElementById("playBtn");
    const progressArea = document.getElementById("progressArea");
    const progressBar = document.getElementById("progressBar");
    const timeRemaining = document.getElementById("timeRemaining");
    const storyCredit = document.getElementById("storyCredit"); // ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á Element ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï
    
    let startTime; 

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå
    if (!letter) {
        document.getElementById("msg").textContent = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á (Missing audio parameter)";
        playBtn.disabled = true;
        return;
    }

    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á
    const filePath = `audio/${letter}.mp3`;
    src.src = filePath;
    audio.load();

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÄ‡∏õ‡πá‡∏ô MM:SS
    function formatTime(seconds) {
        if (isNaN(seconds)) return "--:--";
        const m = Math.floor(seconds / 60);
        const s = Math.floor(seconds % 60);
        return `${m}:${s < 10 ? '0' : ''}${s}`;
    }

    // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°
    playBtn.onclick = () => {
        playBtn.disabled = true;
        playBtn.textContent = "üîä ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢...";
        playBtn.style.backgroundColor = "#888"; 
        
        progressArea.style.display = "block"; // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ñ‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
        
        // [‡πÄ‡∏û‡∏¥‡πà‡∏°] ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ï‡∏≤‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ü‡∏±‡∏á (A ‡∏´‡∏£‡∏∑‡∏≠ B)
        if (letter === "A") {
            storyCredit.textContent = "‡∏ó‡∏µ‡πà‡∏°‡∏≤: ‡∏Ñ‡∏±‡∏î‡∏ï‡∏±‡∏î‡∏ï‡∏≠‡∏ô‡∏à‡∏≤‡∏Å Alice's Adventures in Wonderland ‡πÇ‡∏î‡∏¢ Lewis Carroll";
        } else if (letter === "B") {
            storyCredit.textContent = "‡∏ó‡∏µ‡πà‡∏°‡∏≤: ‡∏Ñ‡∏±‡∏î‡∏ï‡∏±‡∏î‡∏ï‡∏≠‡∏ô‡∏à‡∏≤‡∏Å The Happy Prince ‡πÇ‡∏î‡∏¢ Oscar Wilde";
        }
        storyCredit.style.display = "block"; // ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï

        startTime = new Date(); 
        
        audio.play()
        .then(() => {
            console.log("Audio playing...");
        })
        .catch(err => {
            document.getElementById("msg").textContent = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö";
            console.error(err);
        });
    };

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Progress Bar ‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤
    audio.ontimeupdate = () => {
        if (audio.duration) {
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå
            const percent = (audio.currentTime / audio.duration) * 100;
            progressBar.style.width = `${percent}%`;

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
            const timeLeft = audio.duration - audio.currentTime;
            timeRemaining.textContent = `‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤: ${formatTime(timeLeft)}`;
        }
    };

    // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏à‡∏ö
    audio.onended = () => {
        const endTime = new Date();
        const timeSpent = Math.round((endTime - startTime) / 1000); 

        // ‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
        playBtn.textContent = "‚úÖ ‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß";
        document.getElementById("statusText").textContent = "‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô";
        progressBar.style.width = "100%";
        timeRemaining.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏™‡∏π‡πà‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö...";

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤
        const data = window.Experiment.loadExperimentData();
        
        // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà Phase 1 ‡∏´‡∏£‡∏∑‡∏≠ 2 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
        const isPhase2 = window.location.href.includes("phase2");
        if (isPhase2) {
            data.listen_time_P2 = timeSpent;
        } else {
            data.listen_time = timeSpent;
        }
        
        window.Experiment.saveExperimentData(data);

        // ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß)
        setTimeout(() => {
             // ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Quiz (‡πÉ‡∏ä‡πâ phase1 ‡∏´‡∏£‡∏∑‡∏≠ phase2 ‡∏ï‡∏≤‡∏°‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô)
             if (isPhase2) {
                 window.location.href = `phase2_quiz.html?set=${set}&article=${letter}`;
             } else {
                 window.location.href = `phase1_quiz.html?set=${set}&article=${letter}`;
             }
        }, 1500);
    };

})();
</script>

</body>
</html>