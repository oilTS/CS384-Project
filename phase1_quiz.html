<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>แบบทดสอบ</title>
<link rel="stylesheet" href="style.css">
<script src="main.js"></script>
</head>

<body>
<h2>แบบทดสอบความเข้าใจ</h2>

<div id="quiz-container"></div>

<p id="err" class="error"></p>

<button id="submitBtn">ส่งคำตอบ</button>

<script>
(function(){
    const set = getParam("set");
    const articleLetter = getParam("article");

    const qs = QUESTIONS[articleLetter];
    const box = document.getElementById("quiz-container");

    // สร้างฟอร์มแบบทดสอบ
    qs.forEach((item, index) => {
        box.innerHTML += `
            <div class="question-block">
                <p><b>${index + 1}. ${item.q}</b></p>
                ${item.choices.map((c, i) => `
                    <label>
                        <input type="radio" name="q${index}" value="${i}">
                        ${c}
                    </label><br>
                `).join("")}
                <hr>
            </div>
        `;
    });

    document.getElementById("submitBtn").onclick = () => {
        let allAnswered = true;

        qs.forEach((_, i) => {
            const chk = document.querySelector(`input[name="q${i}"]:checked`);
            if (!chk) allAnswered = false;
        });

        if (!allAnswered) {
            document.getElementById("err").textContent = "กรุณาตอบทุกข้อก่อนส่ง";
            return;
        }

        // ไปหน้าถัดไปตาม Phase
        if (window.location.pathname.includes("phase1")) {
            if (CONDITION[set].second.startsWith("read")) {
                const letter = CONDITION[set].second.endsWith("A") ? "A" : "B";
                window.location = `phase2_read_ready.html?set=${set}&article=${letter}`;
            } else {
                const letter = CONDITION[set].second.endsWith("A") ? "A" : "B";
                window.location = `phase2_listen_ready.html?set=${set}&audio=${letter}`;
            }
        } else {
            window.location = `final_survey.html?set=${set}`;
        }
    };
})();
</script>

</body>
</html>
