<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>อ่านบทความ (Phase 1)</title>
<link rel="stylesheet" href="style.css">
<script src="main.js"></script>
</head>

<body>
<h2>อ่านบทความ — Phase 1</h2>

<div id="timer" class="notice">เวลา: 180 วินาที</div>

<div id="articleBox" class="article-box">กำลังโหลดบทความ...</div>

<button id="doneBtn">อ่านเรียบร้อยแล้ว</button>

<script>
(async () => {
    const set = window.Experiment.getParam("set");
    const articleLetter = window.Experiment.getParam("article");

    const html = await window.Experiment.loadArticle(articleLetter);
    document.getElementById("articleBox").innerHTML = html;

    let t = 180;
    const TOTAL_TIME = 180; 
    const timerEl = document.getElementById("timer");

    const interval = setInterval(() => {
        t--;
        timerEl.textContent = `เวลา: ${t} วินาที`;

        if (t <= 0) {
            clearInterval(interval);
            
            const data = window.Experiment.loadExperimentData();
            data.read_time = TOTAL_TIME; 
            window.Experiment.saveExperimentData(data);

            window.location = `phase1_quiz.html?set=${set}&article=${articleLetter}`;
        }
    }, 1000);

    document.getElementById("doneBtn").onclick = () => {
        clearInterval(interval);
        
        const timeSpent = TOTAL_TIME - t;
        const data = window.Experiment.loadExperimentData();
        data.read_time = timeSpent; 
        window.Experiment.saveExperimentData(data);

        window.location = `phase1_quiz.html?set=${set}&article=${articleLetter}`;
    };
})();
</script>

</body>
</html>