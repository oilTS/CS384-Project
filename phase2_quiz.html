<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>แบบทดสอบ (Phase 2)</title>
<link rel="stylesheet" href="style.css">
<script src="main.js"></script>
</head>

<body>
<h2>แบบทดสอบความเข้าใจ (Phase 2)</h2>

<div id="quiz-container"></div>

<p id="err" class="error"></p>

<button id="submitBtn">ส่งคำตอบ</button>

<script>
(function(){
    const set = window.Experiment.getParam("set");
    const articleLetter = window.Experiment.getParam("article");
    const containerId = "quiz-container";
    
    window.Experiment.renderQuiz(articleLetter, containerId); 

    document.getElementById("submitBtn").onclick = () => {
        const result = window.Experiment.validateQuizAnswers(articleLetter, containerId);

        if (!result.ok) {
            document.getElementById("err").textContent = "กรุณาตอบทุกข้อก่อนส่ง";
            return;
        }

        // --- บันทึกข้อมูลคะแนน Phase 2 ---
        const data = window.Experiment.loadExperimentData();
        const nextCondition = window.Experiment.CONDITION[set].second; // P2

        if (nextCondition.startsWith("read")) {
            data.read_score_P2 = result.score;
            data.read_article_P2 = articleLetter; // บันทึกบทความที่อ่าน
        } else {
            data.listen_score_P2 = result.score;
            data.listen_article_P2 = articleLetter; // บันทึกบทความที่ฟัง
        }
        
        window.Experiment.saveExperimentData(data);
        // ---------------------------------

        // จบ Phase 2 เสมอ -> ไปหน้า Survey
        window.location = `final_survey.html?set=${set}`;
    };
})();
</script>

</body>
</html>